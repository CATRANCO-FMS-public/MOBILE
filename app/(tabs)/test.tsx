import React, { useEffect, useState } from 'react';
import { Button, View } from 'react-native';
import MapView, { Marker, Polyline } from 'react-native-maps';

// Your coordinates data
const routeData = [
    { latitude: 8.4663228, longitude: 124.5853069 },
    { latitude: 8.4663551, longitude: 124.5853191 },
    { latitude: 8.46645, longitude: 124.5853533 },
    { latitude: 8.46654, longitude: 124.5853836 },
    { latitude: 8.4666278, longitude: 124.5854141 },
    { latitude: 8.4666686, longitude: 124.5854298 },
    { latitude: 8.4667433, longitude: 124.5854623 },
    { latitude: 8.466823, longitude: 124.5854945 },
    { latitude: 8.4669089, longitude: 124.5855429 },
    { latitude: 8.4669791, longitude: 124.585604 },
    { latitude: 8.4670379, longitude: 124.585676 },
    { latitude: 8.4670847, longitude: 124.5857554 },
    { latitude: 8.4671063, longitude: 124.5857965 },
    { latitude: 8.4671506, longitude: 124.5858793 },
    { latitude: 8.4671961, longitude: 124.5859608 },
    { latitude: 8.4672425, longitude: 124.5860433 },
    { latitude: 8.4672877, longitude: 124.5861226 },
    { latitude: 8.4673328, longitude: 124.5862012 },
    { latitude: 8.4673798, longitude: 124.5862789 },
    { latitude: 8.4674271, longitude: 124.5863578 },
    { latitude: 8.4674733, longitude: 124.5864379 },
    { latitude: 8.4675196, longitude: 124.5865178 },
    { latitude: 8.4675654, longitude: 124.586597 },
    { latitude: 8.4676109, longitude: 124.5866756 },
    { latitude: 8.4676543, longitude: 124.5867534 },
    { latitude: 8.4676999, longitude: 124.5868312 },
    { latitude: 8.4677495, longitude: 124.586909 },
    { latitude: 8.4677973, longitude: 124.5869894 },
    { latitude: 8.4678438, longitude: 124.5870706 },
    { latitude: 8.4678898, longitude: 124.5871513 },
    { latitude: 8.4679361, longitude: 124.5872298 },
    { latitude: 8.4679828, longitude: 124.5873082 },
    { latitude: 8.4680304, longitude: 124.5873865 },
    { latitude: 8.4680785, longitude: 124.5874642 },
    { latitude: 8.4681265, longitude: 124.5875362 },
    { latitude: 8.4681753, longitude: 124.5876112 },
    { latitude: 8.4682014, longitude: 124.5876556 },
    { latitude: 8.4682581, longitude: 124.5877355 },
    { latitude: 8.4683081, longitude: 124.5878179 },
    { latitude: 8.4683641, longitude: 124.5878994 },
    { latitude: 8.4683897, longitude: 124.587943 },
    { latitude: 8.4684446, longitude: 124.5880117 },
    { latitude: 8.4684979, longitude: 124.5880822 },
    { latitude: 8.4685273, longitude: 124.5881253 },
    { latitude: 8.468579, longitude: 124.5881723 },
    { latitude: 8.4686622, longitude: 124.5882385 },
    { latitude: 8.4687455, longitude: 124.5882925 },
    { latitude: 8.4688247, longitude: 124.5883496 },
    { latitude: 8.4688962, longitude: 124.5884099 },
    { latitude: 8.4689306, longitude: 124.5884405 },
    { latitude: 8.468997, longitude: 124.5885038 },
    { latitude: 8.4690634, longitude: 124.5885703 },
    { latitude: 8.4690964, longitude: 124.5886036 },
    { latitude: 8.4691606, longitude: 124.588669 },
    { latitude: 8.4692213, longitude: 124.5887337 },
    { latitude: 8.4692817, longitude: 124.5888036 },
    { latitude: 8.469343, longitude: 124.5888737 },
    { latitude: 8.4694054, longitude: 124.5889434 },
    { latitude: 8.4694686, longitude: 124.5890134 },
    { latitude: 8.4695313, longitude: 124.5890829 },
    { latitude: 8.4695936, longitude: 124.5891526 },
    { latitude: 8.4696543, longitude: 124.5892234 },
    { latitude: 8.4697137, longitude: 124.5892941 },
    { latitude: 8.4697724, longitude: 124.5893644 },
    { latitude: 8.4698296, longitude: 124.5894355 },
    { latitude: 8.4698839, longitude: 124.5895086 },
    { latitude: 8.4699356, longitude: 124.5895806 },
    { latitude: 8.4699825, longitude: 124.5896513 },
    { latitude: 8.4700255, longitude: 124.5897236 },
    { latitude: 8.4700755, longitude: 124.589796 },
    { latitude: 8.4701331, longitude: 124.5898716 },
    { latitude: 8.4701886, longitude: 124.5899467 },
    { latitude: 8.4702441, longitude: 124.5900186 },
    { latitude: 8.4703012, longitude: 124.5900872 },
    { latitude: 8.4703591, longitude: 124.5901589 },
    { latitude: 8.4704175, longitude: 124.590233 },
    { latitude: 8.4704728, longitude: 124.5903107 },
    { latitude: 8.4705224, longitude: 124.5903919 },
    { latitude: 8.4705608, longitude: 124.5904818 },
    { latitude: 8.4705965, longitude: 124.5905688 },
    { latitude: 8.470614, longitude: 124.5906129 },
    { latitude: 8.4706447, longitude: 124.5907037 },
    { latitude: 8.470672, longitude: 124.5907945 },
    { latitude: 8.4707011, longitude: 124.5908823 },
    { latitude: 8.4707362, longitude: 124.5909676 },
    { latitude: 8.4707775, longitude: 124.5910503 },
    { latitude: 8.470821, longitude: 124.5911299 },
    { latitude: 8.4708671, longitude: 124.5912099 },
    { latitude: 8.4709166, longitude: 124.5912872 },
    { latitude: 8.4709676, longitude: 124.5913615 },
    { latitude: 8.4710205, longitude: 124.5914326 },
    { latitude: 8.4710749, longitude: 124.5915029 },
    { latitude: 8.4711219, longitude: 124.5915806 },
    { latitude: 8.4711697, longitude: 124.5916585 },
    { latitude: 8.4712241, longitude: 124.59173 },
    { latitude: 8.4712494, longitude: 124.5917637 },
    { latitude: 8.4712971, longitude: 124.5918284 },
    { latitude: 8.4713527, longitude: 124.5919049 },
    { latitude: 8.471406, longitude: 124.5919739 },
    { latitude: 8.4714609, longitude: 124.5920474 },
    { latitude: 8.4715195, longitude: 124.592126 },
    { latitude: 8.4715641, longitude: 124.5922073 },
    { latitude: 8.4716075, longitude: 124.5922115 },
    { latitude: 8.4716206, longitude: 124.5922859 },
    { latitude: 8.4716801, longitude: 124.5923529 },
    { latitude: 8.4717324, longitude: 124.5924251 },
    { latitude: 8.4717835, longitude: 124.5924991 },
    { latitude: 8.4718419, longitude: 124.5925734 },
    { latitude: 8.4718979, longitude: 124.592647 },
    { latitude: 8.4719579, longitude: 124.5927181 },
    { latitude: 8.4720099, longitude: 124.592795 },
    { latitude: 8.4720618, longitude: 124.5928682 },
    { latitude: 8.4720898, longitude: 124.5929055 },
    { latitude: 8.4721454, longitude: 124.5929803 },
    { latitude: 8.4721982, longitude: 124.5930543 },
    { latitude: 8.4722484, longitude: 124.5931311 },
    { latitude: 8.4723232, longitude: 124.5932538 },
    { latitude: 8.4723757, longitude: 124.5933279 },
    { latitude: 8.4724586, longitude: 124.5934328 },
    { latitude: 8.4725146, longitude: 124.5935073 },
    { latitude: 8.4725631, longitude: 124.593579 },
    { latitude: 8.4726136, longitude: 124.5936513 },
    { latitude: 8.4726758, longitude: 124.5937193 },
    { latitude: 8.4727351, longitude: 124.5937878 },
    { latitude: 8.4727964, longitude: 124.5938563 },
    { latitude: 8.4728653, longitude: 124.5939234 },
    { latitude: 8.4729386, longitude: 124.5939862 },
    { latitude: 8.4730134, longitude: 124.594049 },
    { latitude: 8.4730479, longitude: 124.5940791 },
    { latitude: 8.4731126, longitude: 124.5941375 },
    { latitude: 8.4731669, longitude: 124.5942009 },
    { latitude: 8.4732249, longitude: 124.5942726 },
    { latitude: 8.4732867, longitude: 124.5943456 },
    { latitude: 8.4733523, longitude: 124.5944112 },
    { latitude: 8.4734172, longitude: 124.594475 },
    { latitude: 8.4734856, longitude: 124.5945416 },
    { latitude: 8.4735408, longitude: 124.5946072 },
    { latitude: 8.473598, longitude: 124.5946797 },
    { latitude: 8.4736598, longitude: 124.5947986 },
    { latitude: 8.4737047, longitude: 124.5948812 },
    { latitude: 8.473757, longitude: 124.5949547 },
    { latitude: 8.4738096, longitude: 124.595029 },
    { latitude: 8.4738705, longitude: 124.595102 },
    { latitude: 8.4739171, longitude: 124.5951822 },
    { latitude: 8.473962, longitude: 124.5952655 },
    { latitude: 8.4740061, longitude: 124.5953416 },
    { latitude: 8.4740683, longitude: 124.5954291 },
    { latitude: 8.4741211, longitude: 124.5955034 },
    { latitude: 8.4741711, longitude: 124.5955808 },
    { latitude: 8.4742237, longitude: 124.5956655 },
    { latitude: 8.4742763, longitude: 124.595748 },
    { latitude: 8.4743238, longitude: 124.595819 },
    { latitude: 8.4743861, longitude: 124.5959118 },
    { latitude: 8.4744453, longitude: 124.596004 },
    { latitude: 8.4745062, longitude: 124.596074 },
    { latitude: 8.4745544, longitude: 124.5961454 },
    { latitude: 8.4746109, longitude: 124.5962366 },
    { latitude: 8.4746647, longitude: 124.5963111 },
    { latitude: 8.4747155, longitude: 124.5963832 },
    { latitude: 8.4747652, longitude: 124.5964549 },
    { latitude: 8.4748094, longitude: 124.5965347 },
    { latitude: 8.4748358, longitude: 124.5965655 },
    { latitude: 8.4748885, longitude: 124.5966145 },
    { latitude: 8.4748594, longitude: 124.5966949 },
    { latitude: 8.4747999, longitude: 124.5967419 },
    { latitude: 8.4747778, longitude: 124.5967838 },
    { latitude: 8.4747331, longitude: 124.5968399 },
    { latitude: 8.4746841, longitude: 124.5969273 },
    { latitude: 8.4746349, longitude: 124.5970089 },
    { latitude: 8.474578, longitude: 124.5970852 },
    { latitude: 8.4745482, longitude: 124.5971217 },
    { latitude: 8.4744866, longitude: 124.5971941 },
    { latitude: 8.4744236, longitude: 124.5972639 },
    { latitude: 8.4743605, longitude: 124.597332 },
    { latitude: 8.4742982, longitude: 124.5973989 },
    { latitude: 8.4742357, longitude: 124.5974682 },
    { latitude: 8.4741754, longitude: 124.5975404 },
    { latitude: 8.47412, longitude: 124.597621 },
    { latitude: 8.4740954, longitude: 124.5976605 },
    { latitude: 8.4740501, longitude: 124.5977409 },
    { latitude: 8.4739898, longitude: 124.597865 },
    { latitude: 8.4739435, longitude: 124.5979061 },
    { latitude: 8.4739534, longitude: 124.5979515 },
    { latitude: 8.4739364, longitude: 124.5979955 },
    { latitude: 8.4739064, longitude: 124.5980808 },
    { latitude: 8.4738771, longitude: 124.5981683 },
    { latitude: 8.4738472, longitude: 124.5982557 },
    { latitude: 8.4738567, longitude: 124.5983076 },
    { latitude: 8.4738392, longitude: 124.5983588 },
    { latitude: 8.4738049, longitude: 124.5984602 },
    { latitude: 8.4737381, longitude: 124.5985103 },
    { latitude: 8.4737033, longitude: 124.5985964 },
    { latitude: 8.4736715, longitude: 124.5986828 },
    { latitude: 8.4736418, longitude: 124.5987694 },
    { latitude: 8.4736126, longitude: 124.5988568 },
    { latitude: 8.473582, longitude: 124.5989444 },
    { latitude: 8.473551, longitude: 124.5990307 },
    { latitude: 8.4735869, longitude: 124.599082 },
    { latitude: 8.4735572, longitude: 124.5991694 },
    { latitude: 8.4735282, longitude: 124.5992574 },
    { latitude: 8.473499, longitude: 124.5993457 },
    { latitude: 8.4734715, longitude: 124.5994303 },
    { latitude: 8.4734103, longitude: 124.5994795 },
    { latitude: 8.473385, longitude: 124.5995722 },
    { latitude: 8.4733605, longitude: 124.5996626 },
    { latitude: 8.4733364, longitude: 124.5997518 },
    { latitude: 8.4733117, longitude: 124.599841 },
    { latitude: 8.473289, longitude: 124.5999319 },
    { latitude: 8.4732684, longitude: 124.6000239 },
    { latitude: 8.4732502, longitude: 124.6001154 },
    { latitude: 8.4732333, longitude: 124.6002062 },
    { latitude: 8.4732191, longitude: 124.6002948 },
    { latitude: 8.4732049, longitude: 124.600382 },
    { latitude: 8.4731888, longitude: 124.6004728 },
    { latitude: 8.4731705, longitude: 124.600566 },
    { latitude: 8.4731534, longitude: 124.6006599 },
    { latitude: 8.4731486, longitude: 124.6007441 },
    { latitude: 8.4731442, longitude: 124.6008393 },
    { latitude: 8.4731421, longitude: 124.600931 },
    { latitude: 8.4731416, longitude: 124.6009778 },
    { latitude: 8.4731414, longitude: 124.6010739 },
    { latitude: 8.4731426, longitude: 124.6011695 },
    { latitude: 8.4731461, longitude: 124.6012649 },
    { latitude: 8.4731495, longitude: 124.601361 },
    { latitude: 8.4731528, longitude: 124.6014571 },
    { latitude: 8.4731566, longitude: 124.6015521 },
    { latitude: 8.47316, longitude: 124.6016451 },
    { latitude: 8.4731637, longitude: 124.6017374 },
    { latitude: 8.4731675, longitude: 124.6018309 },
    { latitude: 8.473171, longitude: 124.6019233 },
    { latitude: 8.4731726, longitude: 124.6020141 },
    { latitude: 8.4731728, longitude: 124.6021048 },
    { latitude: 8.4731697, longitude: 124.6021964 },
    { latitude: 8.4731599, longitude: 124.6022881 },
    { latitude: 8.4731455, longitude: 124.6023793 },
    { latitude: 8.4731248, longitude: 124.6024682 },
    { latitude: 8.4730966, longitude: 124.6025552 },
    { latitude: 8.4730656, longitude: 124.6026406 },
    { latitude: 8.4730349, longitude: 124.6027276 },
    { latitude: 8.4730044, longitude: 124.6028162 },
    { latitude: 8.4729737, longitude: 124.602904 },
    { latitude: 8.4729432, longitude: 124.6029914 },
    { latitude: 8.4729121, longitude: 124.6030782 },
    { latitude: 8.4728811, longitude: 124.603164 },
    { latitude: 8.4728517, longitude: 124.6032493 },
    { latitude: 8.4728251, longitude: 124.6033361 },
    { latitude: 8.4728135, longitude: 124.6033831 },
    { latitude: 8.4727992, longitude: 124.603473 },
    { latitude: 8.4727935, longitude: 124.6035648 },
    { latitude: 8.4727963, longitude: 124.6036568 },
    { latitude: 8.472806, longitude: 124.6037494 },
    { latitude: 8.4728149, longitude: 124.6038439 },
    { latitude: 8.4728264, longitude: 124.6039357 },
    { latitude: 8.4728405, longitude: 124.6040269 },
    { latitude: 8.4728567, longitude: 124.6041174 },
    { latitude: 8.472873, longitude: 124.6042068 },
    { latitude: 8.4728893, longitude: 124.6042961 },
    { latitude: 8.4729066, longitude: 124.6043837 },
    { latitude: 8.4729247, longitude: 124.6044702 },
    { latitude: 8.4729406, longitude: 124.604561 },
    { latitude: 8.4729558, longitude: 124.6046515 },
    { latitude: 8.4729696, longitude: 124.6047394 },
    { latitude: 8.4729839, longitude: 124.6048659 },
    { latitude: 8.4729873, longitude: 124.6049451 },
    { latitude: 8.4729968, longitude: 124.6050187 },
    { latitude: 8.473019, longitude: 124.6051151 },
    { latitude: 8.4730506, longitude: 124.6052191 },
    { latitude: 8.4730756, longitude: 124.605311 },
    { latitude: 8.4730955, longitude: 124.6054003 },
    { latitude: 8.4731152, longitude: 124.6054881 },
    { latitude: 8.4731349, longitude: 124.6055732 },
    { latitude: 8.4731687, longitude: 124.6057056 },
    { latitude: 8.4731875, longitude: 124.6058028 },
    { latitude: 8.4732059, longitude: 124.6058974 },
    { latitude: 8.4732253, longitude: 124.6059906 },
    { latitude: 8.4732444, longitude: 124.606081 },
    { latitude: 8.4732621, longitude: 124.606171 },
    { latitude: 8.4732802, longitude: 124.6062618 },
    { latitude: 8.4733093, longitude: 124.6063949 },
    { latitude: 8.4733189, longitude: 124.6064395 },
    { latitude: 8.4733353, longitude: 124.6065276 },
    { latitude: 8.4733502, longitude: 124.6066184 },
    { latitude: 8.4733546, longitude: 124.6066756 },
    { latitude: 8.4733668, longitude: 124.6067679 },
    { latitude: 8.4733745, longitude: 124.6068602 },
    { latitude: 8.4733769, longitude: 124.6069506 },
    { latitude: 8.4733783, longitude: 124.607043 },
    { latitude: 8.473379, longitude: 124.6071347 },
    { latitude: 8.4733776, longitude: 124.6072268 },
    { latitude: 8.4733802, longitude: 124.607321 },
    { latitude: 8.473381, longitude: 124.607308 },
    { latitude: 8.4733839, longitude: 124.6073966 },
    { latitude: 8.4733892, longitude: 124.6074868 },
    { latitude: 8.4733986, longitude: 124.6075807 },
    { latitude: 8.4734097, longitude: 124.6076741 },
    { latitude: 8.4734205, longitude: 124.6077666 },
    { latitude: 8.4734308, longitude: 124.6078595 },
    { latitude: 8.4734402, longitude: 124.6079508 },
    { latitude: 8.4734496, longitude: 124.6080425 },
    { latitude: 8.4734602, longitude: 124.6081336 },
    { latitude: 8.4734902, longitude: 124.6081873 },
    { latitude: 8.4734924, longitude: 124.6083153 },
    { latitude: 8.4735174, longitude: 124.6084057 },
    { latitude: 8.4735481, longitude: 124.6084942 },
    { latitude: 8.4735844, longitude: 124.6085802 },
    { latitude: 8.4736233, longitude: 124.6086654 },
    { latitude: 8.4736434, longitude: 124.6087075 },
    { latitude: 8.4736853, longitude: 124.6087889 },
    { latitude: 8.4737511, longitude: 124.6089102 },
    { latitude: 8.4737964, longitude: 124.6089906 },
    { latitude: 8.4738225, longitude: 124.6090451 },
    { latitude: 8.473848, longitude: 124.6090882 },
    { latitude: 8.4738843, longitude: 124.6091514 },
    { latitude: 8.4739272, longitude: 124.6092335 },
    { latitude: 8.473989, longitude: 124.609311 },
    { latitude: 8.4740262, longitude: 124.6093918 },
    { latitude: 8.4741034, longitude: 124.6095547 },
    { latitude: 8.4741826, longitude: 124.6097223 },
    { latitude: 8.4742222, longitude: 124.6098057 },
    { latitude: 8.4742619, longitude: 124.609889 },
    { latitude: 8.4743016, longitude: 124.6099727 },
    { latitude: 8.4743423, longitude: 124.6100568 },
    { latitude: 8.4743852, longitude: 124.6101398 },
    { latitude: 8.4744306, longitude: 124.6102215 },
    { latitude: 8.4744781, longitude: 124.6103032 },
    { latitude: 8.4745273, longitude: 124.6103835 },
    { latitude: 8.4745805, longitude: 124.6104596 },
    { latitude: 8.4746297, longitude: 124.6105599 },
    { latitude: 8.4746965, longitude: 124.6106241 },
    { latitude: 8.4747691, longitude: 124.6106833 },
    { latitude: 8.4748439, longitude: 124.6107389 },
    { latitude: 8.4749193, longitude: 124.6107951 },
    { latitude: 8.4749927, longitude: 124.6108499 },
    { latitude: 8.4750663, longitude: 124.6109003 },
    { latitude: 8.4751492, longitude: 124.6109356 },
    { latitude: 8.4752408, longitude: 124.6109287 },
    { latitude: 8.4753306, longitude: 124.6109373 },
    { latitude: 8.4754207, longitude: 124.6109352 },
    { latitude: 8.4755111, longitude: 124.6109308 },
    { latitude: 8.4756037, longitude: 124.610927 },
    { latitude: 8.4757764, longitude: 124.6109536 },
    { latitude: 8.4758632, longitude: 124.6109859 },
    { latitude: 8.4759463, longitude: 124.6110228 },
    { latitude: 8.4759833, longitude: 124.6111195 },
    { latitude: 8.4760355, longitude: 124.6112278 },
    { latitude: 8.4760076, longitude: 124.6113486 },
    { latitude: 8.475999, longitude: 124.6114423 },
    { latitude: 8.476007, longitude: 124.611547 },
    { latitude: 8.475996, longitude: 124.6116395 },
    { latitude: 8.4759729, longitude: 124.6118273 },
    { latitude: 8.475946, longitude: 124.6120194 }
];

const RouteSimulation = () => {
  const [markerPosition, setMarkerPosition] = useState(routeData[0]); // Start at the first point
  const [polylineCoordinates, setPolylineCoordinates] = useState([routeData[0]]); // Start the polyline with the first point
  const [currentIndex, setCurrentIndex] = useState(0); // Track the current point index
  const [isMoving, setIsMoving] = useState(false);

  useEffect(() => {
    // Animate the marker along the polyline
    if (isMoving && currentIndex < routeData.length - 1) {
      const intervalId = setInterval(() => {
        setCurrentIndex((prevIndex) => {
          if (prevIndex + 1 < routeData.length) {
            setMarkerPosition(routeData[prevIndex + 1]);
            setPolylineCoordinates((prevCoordinates) => [
              ...prevCoordinates,
              routeData[prevIndex + 1],
            ]);
            return prevIndex + 1;
          } else {
            clearInterval(intervalId); // Stop when we reach the last point
            return prevIndex;
          }
        });
      }, 1000); // Adjust the interval for speed of movement

      return () => clearInterval(intervalId); // Cleanup on unmount
    }
  }, [isMoving, currentIndex]);

  const startSimulation = () => {
    setIsMoving(true);
  };

  return (
    <View style={{ flex: 1 }}>
      <MapView style={{ flex: 1 }} initialRegion={{
        latitude: routeData[0].latitude,
        longitude: routeData[0].longitude,
        latitudeDelta: 0.01,
        longitudeDelta: 0.01,
      }}>
        <Polyline coordinates={polylineCoordinates} strokeColor="blue" strokeWidth={6} />
        <Marker coordinate={markerPosition} />
      </MapView>

      {!isMoving && (
        <Button title="Start Simulation" onPress={startSimulation} />
      )}
    </View>
  );
};

export default RouteSimulation;
